name: Build Fence Calculator Executable

on:
  push:
    branches:
      - main  # Срабатывает при каждом пуше в ветку main
  workflow_dispatch:  # Позволяет запускать вручную из интерфейса GitHub

jobs:
  build:
    runs-on: windows-latest  # Используем Windows для сборки .exe

    steps:
      # Шаг 1: Выполняем чекаут кода
      - name: Checkout code
        uses: actions/checkout@v3

      # Шаг 2: Устанавливаем Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'  # Укажите версию Python

      # Шаг 3: Устанавливаем зависимости
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Шаг 4: Собираем исполняемый файл с помощью PyInstaller
      - name: Build executable
        run: |
          pyinstaller --onefile --windowed fence_calculator.py
          # Если у вас есть дополнительные файлы, добавьте их через --add-data
          # pyinstaller --onefile --windowed --add-data "prices.xlsx;." fence_calculator.py

      # Шаг 5: Архивируем результаты
      - name: Archive artifacts
        run: |
          mkdir dist_artifacts
          cp dist/fence_calculator.exe dist_artifacts/
          tar -czvf fence_calculator_artifacts.tar.gz dist_artifacts/

      # Шаг 6: Публикуем артефакты
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: fence-calculator-exe
          path: fence_calculator_artifacts.tar.gz
